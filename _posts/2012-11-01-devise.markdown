---
layout: default
title: הוספת אותנטיקציה עם Devise
permalink: devise
---

# הוספת אותנטיקציה עם Devise

*נוצר על-ידי Piotr Steininger, [@polishprince](https://twitter.com/polishprince)*

*עודכן על-ידי Ernesto Jimenez, [@ernesto_jimenez](https://twitter.com/ernesto_jimenez)*

**מדריך זה מניח שכבר בנית אפלקציית RailsGirls לפי ** [**מדריך בניית האפליקציה הראשונה שלך**](/app).


## שלב 0: הוסיפי את ה-devise gem

פתחי את קובץ ה-`Gemfile` והוסיפי לו את השורה הבאה

{% highlight ruby %}
gem 'devise'
{% endhighlight %}
ולאחר מכן הריצי את הפקודה
{% highlight sh %}
bundle install
{% endhighlight %}
כדי להתקין את ה-gem. **כמו כן, זכרי לאתחל את שרת ה-Rails.**.

## שלב 1: הרכיבי את devise לתוך האפליקציה

הריצי את הפקודה הבאה בטרמינל.

{% highlight sh %}
rails g devise:install
{% endhighlight %}


## שלב 2: הגדירי את Devise

ודאי שהגדרת את ה-URL הדיפולטיווי של האפליקציה בקובץ environment. פתחי את הקובץ `config/environments/development.rb` והוסיפי את השורה הזאת:
{% highlight ruby %}
   config.action_mailer.default_url_options = { :host => 'localhost:3000' }
{% endhighlight %}

לפני המילה `end`.

פתחי את `app/views/layouts/application.html.erb` והוסיפי:

{% highlight erb %}
<% if notice %>
  <p class="alert alert-notice"><%= notice %></p>
<% end %>
<% if alert %>
  <p class="alert alert-error"><%= alert %></p>
<% end %>
{% endhighlight %}
שורה מעל
{% highlight ruby %}
   <%= yield %>
{% endhighlight %}

לסיום, אם את מתכננת [להעלות ל-Heroku](/heroku) פתחי את `config/application.rb` והוסיפי את השורה הזו:
{% highlight ruby %}
  config.assets.initialize_on_precompile = false
{% endhighlight %}
כשורה השלישית מהסוף (לפני הראשונה מבין שתי ה-`end`)

## שלב 3: בני את ה-user model

נשתמש ב-generator שהגיע עם ה-gem כדי שיבנה לנו אוטומטית את ה-user model.
{% highlight sh %}
   rails g devise user
   rake db:migrate
{% endhighlight %}

**Coach:** הסבר/הסבירי את ה-user model שנוצר. מהם השדות שלו?

## שלב 4: צרי את המשתמש הראשון שלך

כעת אחרי שהכנו את הכל, תוכלי ליצור את המשתמש הראשון. Devise יוצר את כל הקוד ואת ה-routes הנחוצים ליצירת חשבון, log in, log out וכו'.

ודאי ששרת ה-Rails רץ לגלשי לכתובת [http://localhost:3000/users/sign_up](http://localhost:3000/users/sign_up) וצרי את חשבון המשתמש שלך.

## שלב 5: הוסיפי לינקים להרשמה וכניסה

כל מה שנצטרך לעשות עכשיו הוא להוסיף את הלינקים להרשמה או כניסה לאתר בפינת ב-Header של האתר או בתפריט הניווט. במידה והמשתמש כבר מחובר למערכת, נציג הודעה במתאימה במקום הלינקים האלו.

לשם כך, ערכי את `app/views/layouts/application.html.erb` והיספי:
{% highlight erb %}
<p class="navbar-text pull-right">
<% if user_signed_in? %>
  Logged in as <strong><%= current_user.email %></strong>.
  <%= link_to 'Edit profile', edit_user_registration_path, :class => 'navbar-link' %> |
  <%= link_to "Logout", destroy_user_session_path, method: :delete, :class => 'navbar-link'  %>
<% else %>
  <%= link_to "Sign up", new_user_registration_path, :class => 'navbar-link'  %> |
  <%= link_to "Login", new_user_session_path, :class => 'navbar-link'  %>
<% end %>
{% endhighlight %}
מיד אחרי
{% highlight erb %}
<ul class="nav">
  <li class="active"><a href="/ideas">Ideas</a></li>
</ul>
{% endhighlight %}


פתחי את הדפדפן ונסי להכנס ולצאת מהאפליקציה.

**Coach:** דבר/י על `user_signed_in?` ו- `current_user` helpers. למה הם משמשים?

## מה הלאה?

* הוסיפי שדות נוספים ל-user model 
* הוסיפי קשרים בין משתמשים ורעיונות
* דאגי לכך שמשתמשים יוכלו לערוך רק את הרעיונות שלהם
* השתמשי ב-roles ו-permissions (השתמשי באחד ה-gem-ים הפופולארים CanCan)


